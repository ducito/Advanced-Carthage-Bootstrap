#if 0
	shc Version 3.9.8, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f carthage_bootstrap.sh -o carthage_bootstrap 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[0]))
	"\354\210\265\260\020\177\130\077\071\054\354\330\034\165\175\271"
	"\026\132\252\365\314\020"
#define      shll_z	8
#define      shll	((&data[22]))
	"\367\012\211\257\203\156\067\106\167"
#define      chk1_z	22
#define      chk1	((&data[35]))
	"\315\356\371\213\363\077\271\005\217\152\121\355\027\131\217\147"
	"\133\054\205\017\257\062\217\225\337\374\321\017\063\123\075"
#define      msg2_z	19
#define      msg2	((&data[64]))
	"\305\026\352\136\102\133\207\360\135\120\324\062\230\267\302\213"
	"\166\061\111\320\210\217"
#define      rlax_z	1
#define      rlax	((&data[84]))
	"\073"
#define      date_z	1
#define      date	((&data[85]))
	"\335"
#define      opts_z	1
#define      opts	((&data[86]))
	"\327"
#define      lsto_z	1
#define      lsto	((&data[87]))
	"\342"
#define      text_z	1552
#define      text	((&data[193]))
	"\346\322\164\314\130\054\352\260\365\215\151\360\357\146\052\377"
	"\246\040\201\027\321\172\336\122\054\244\256\315\105\056\316\305"
	"\267\351\257\203\367\174\240\374\167\342\025\271\262\046\140\043"
	"\166\224\372\247\023\267\155\310\274\302\105\361\356\026\016\324"
	"\046\231\114\327\362\060\045\141\022\034\315\250\050\276\313\177"
	"\052\307\051\307\317\127\233\370\064\354\036\046\245\366\006\216"
	"\123\225\252\007\207\327\151\246\224\366\263\067\333\332\034\231"
	"\036\214\335\015\344\171\010\177\021\016\256\143\312\320\166\103"
	"\164\334\336\033\130\143\247\206\047\211\273\333\206\277\050\040"
	"\331\104\056\273\377\377\151\147\051\014\061\150\016\202\317\236"
	"\076\200\017\170\261\367\355\355\021\353\033\117\344\306\157\061"
	"\251\063\305\216\054\014\062\122\344\173\030\076\171\106\356\201"
	"\047\024\171\150\262\347\113\117\312\373\363\323\255\207\110\034"
	"\275\063\132\224\316\237\316\322\275\045\364\151\377\164\233\325"
	"\256\127\235\045\340\030\101\146\226\230\315\211\261\213\032\122"
	"\106\212\156\231\301\160\076\231\257\175\363\021\204\042\002\043"
	"\204\145\277\041\145\140\074\306\163\034\152\147\324\365\277\263"
	"\020\233\376\243\201\306\147\062\315\161\375\164\335\016\231\103"
	"\246\363\313\070\346\277\361\251\330\145\377\310\152\011\135\236"
	"\227\170\156\100\313\020\242\372\207\350\230\057\051\002\242\140"
	"\376\261\036\315\000\242\321\110\255\076\133\332\250\211\271\260"
	"\174\210\072\006\316\101\152\210\061\130\112\074\370\152\355\005"
	"\137\165\124\152\051\231\161\300\330\302\224\214\051\035\362\011"
	"\311\336\074\372\132\233\235\016\364\153\266\234\236\304\343\230"
	"\112\354\256\330\035\165\345\124\044\316\115\057\330\145\240\303"
	"\203\364\203\316\301\252\210\132\073\276\227\235\207\214\360\314"
	"\246\334\221\173\053\154\127\066\007\053\027\072\170\032\330\140"
	"\361\130\072\172\046\174\230\153\220\116\234\316\316\040\102\056"
	"\031\204\102\323\207\022\254\127\357\210\362\073\102\107\053\021"
	"\071\305\234\054\234\061\237\075\250\336\316\221\303\233\250\312"
	"\107\272\021\325\167\034\312\144\004\025\224\205\220\173\324\112"
	"\061\123\031\102\370\353\016\211\356\027\355\264\332\210\246\340"
	"\342\364\162\312\341\171\071\070\007\231\067\111\145\234\112\071"
	"\322\154\301\076\226\011\001\063\231\303\165\166\163\062\115\141"
	"\314\007\121\155\242\236\364\361\132\064\021\304\030\332\044\040"
	"\057\255\346\244\002\105\370\301\315\366\011\353\030\130\025\023"
	"\230\045\024\267\002\210\111\107\011\142\274\360\176\270\375\237"
	"\212\007\300\300\044\100\033\345\137\126\230\157\267\045\021\170"
	"\205\024\130\107\204\070\161\225\130\001\315\164\307\016\065\274"
	"\211\261\206\350\262\337\035\146\073\201\301\002\355\173\214\067"
	"\142\305\154\201\333\245\011\121\376\031\111\225\262\005\350\147"
	"\140\177\176\276\141\321\077\110\216\334\271\012\164\303\313\142"
	"\104\330\222\171\344\363\134\045\222\366\114\135\152\033\041\323"
	"\001\126\177\065\234\054\135\200\344\120\355\112\307\346\073\373"
	"\174\114\065\127\064\051\172\016\126\303\221\106\277\154\246\320"
	"\247\340\365\363\332\213\002\312\024\207\242\203\077\160\206\027"
	"\116\126\122\062\203\043\062\267\250\213\206\350\236\066\347\057"
	"\354\117\041\016\151\103\124\230\155\246\141\314\260\167\255\336"
	"\310\253\305\014\006\331\030\220\357\176\306\164\254\372\013\030"
	"\325\076\155\206\265\364\200\143\222\206\101\360\076\105\360\021"
	"\205\333\266\354\050\071\127\040\110\206\345\153\311\015\310\303"
	"\225\300\336\121\221\051\034\271\152\272\212\022\257\113\371\067"
	"\374\061\111\247\321\340\361\142\206\036\014\033\154\242\071\130"
	"\306\041\124\002\211\375\172\134\044\256\060\367\372\231\201\213"
	"\123\322\315\334\357\036\220\050\154\222\224\131\132\121\323\073"
	"\125\123\356\150\042\320\003\156\052\115\126\153\250\312\265\023"
	"\221\113\222\241\312\027\103\032\347\045\155\254\313\112\171\064"
	"\234\127\032\316\216\174\224\127\107\121\250\050\303\163\162\011"
	"\171\267\173\040\276\274\105\205\363\257\245\263\313\366\124\205"
	"\226\176\362\362\061\174\336\337\052\131\307\325\140\152\224\135"
	"\210\176\355\064\215\012\327\152\232\232\347\251\325\367\073\347"
	"\313\235\065\145\216\364\070\313\274\200\020\033\312\347\172\320"
	"\142\127\136\067\004\332\361\231\357\165\050\246\252\342\341\033"
	"\015\273\070\242\115\247\263\217\037\005\064\041\014\044\131\046"
	"\363\102\044\073\015\127\171\051\306\145\354\101\341\153\122\116"
	"\033\210\321\360\140\116\237\015\227\101\232\150\154\141\104\000"
	"\113\211\011\160\221\045\266\112\155\265\277\003\246\052\050\322"
	"\076\055\267\116\345\362\176\220\230\120\303\275\147\317\247\241"
	"\217\020\116\272\346\320\042\241\127\066\056\351\067\100\077\056"
	"\044\366\060\321\363\300\353\111\016\164\156\273\120\004\362\012"
	"\047\223\311\065\216\327\214\252\173\050\040\006\047\032\253\175"
	"\235\137\063\371\134\310\063\360\170\116\066\275\072\172\133\346"
	"\351\323\311\126\356\336\027\047\257\353\070\030\055\031\335\162"
	"\130\317\024\074\204\362\276\013\156\333\363\155\242\022\170\127"
	"\325\216\005\316\030\170\013\245\174\311\156\121\235\244\340\241"
	"\046\203\377\356\214\010\311\132\151\046\240\363\256\324\317\126"
	"\376\176\014\345\147\133\257\053\267\353\357\212\046\057\062\055"
	"\123\025\355\104\071\055\235\051\023\044\127\167\064\073\050\170"
	"\324\366\114\072\320\030\034\222\361\121\334\313\376\147\100\310"
	"\051\156\043\312\351\303\006\346\237\165\055\053\173\053\333\053"
	"\125\030\351\364\125\050\011\344\222\342\306\125\017\232\202\362"
	"\143\227\114\002\011\373\360\142\076\176\375\111\100\256\213\241"
	"\310\075\111\336\310\225\261\146\243\125\152\150\220\021\145\340"
	"\342\256\177\200\045\055\126\344\253\127\116\146\244\373\122\175"
	"\357\237\112\166\265\175\267\035\320\176\104\041\376\046\261\303"
	"\354\172\017\201\131\242\376\234\061\237\206\104\257\330\173\130"
	"\320\116\223\355\071\222\240\062\230\052\136\253\276\152\214\327"
	"\363\127\300\371\160\315\007\010\145\244\056\146\055\343\373\245"
	"\344\352\140\270\323\176\043\230\160\254\105\002\123\012\006\072"
	"\163\225\306\326\116\374\251\016\226\013\125\310\060\375\270\055"
	"\117\235\353\205\140\264\000\334\240\342\021\145\374\365\231\171"
	"\123\311\063\042\166\314\316\302\022\116\363\311\151\215\177\005"
	"\111\355\024\062\104\374\115\010\205\013\231\346\177\064\065\317"
	"\323\375\121\060\162\112\051\215\320\343\105\133\351\357\146\000"
	"\126\263\037\075\300\372\154\065\004\023\003\310\363\214\215\033"
	"\037\220\300\000\221\030\132\240\214\153\022\110\250\234\341\252"
	"\236\365\247\036\220\170\200\073\275\044\104\206\327\147\314\367"
	"\300\171\127\111\115\217\231\353\150\202\162\271\255\327\261\016"
	"\047\057\111\247\325\260\227\167\123\265\100\274\324\200\210\310"
	"\016\073\253\134\212\335\221\370\354\132\071\102\054\272\305\063"
	"\147\154\006\164\057\021\371\126\104\110\312\011\322\317\263\336"
	"\016\205\113\172\040\350\232\060\107\072\133\143\347\005\266\115"
	"\356\051\135\046\367\265\166\011\106\317\226\313\301\242\036\360"
	"\162\220\275\331\177\346\361\117\251\350\065\315\160\353\073\274"
	"\316\041\025\040\001\367\020\212\126\262\160\027\103\070\324\176"
	"\336\106\052\042\055\303\035\141\231\150\354\135\012\362\006\066"
	"\271\343\136\107\075\121\017\213\176\170\065\373\160\233\121\045"
	"\346\371\353\125\236\337\327\122\272\375\065\071\160\251\251\301"
	"\256\307\076\345\133\205\161\052\325\006\370\235\070\327\316\172"
	"\222\142\111\131\007\304\214\105\322\335\057\030\106\227\036\023"
	"\377\064\015\252\245\347\227\146\247\247\303\273\063\251\250\060"
	"\115\300\334\104\262\106\173\377\373\143\051\166\123\046\074\314"
	"\323\210\005\137\150\022\240\172\227\245\036\123\153\146\201\016"
	"\172\352\207\247\260\022\301\133\147\225\366\064\065\241\363\206"
	"\336\157\061\025\112\222\070\142\204\004\366\206\166\203\043\345"
	"\020\256\043\212\044\236\051\206\213\107\002\267\217\314\013\011"
	"\302\217\002\150\336\276\052\345\045\077\136\353\114\160\303\071"
	"\025\302\205\133\224\362\227\330\070\347\076\370\026\064\314\046"
	"\321\261\356\332\302\132\021\076\345\205\343\304\101\120\106\142"
	"\305\364\053\136\036\176\322\276\245\367\371\203\316\370\374\345"
	"\206\222\067\306\353\271\004\223\034\306\325\226\324\111"
#define      inlo_z	3
#define      inlo	((&data[2022]))
	"\277\127\041"
#define      pswd_z	256
#define      pswd	((&data[2060]))
	"\164\317\261\370\071\372\274\132\322\161\334\337\046\230\273\177"
	"\201\106\021\202\312\213\065\325\024\354\012\242\113\007\073\354"
	"\035\030\363\065\112\170\246\071\105\252\132\260\010\363\131\042"
	"\301\021\005\354\217\107\145\173\173\235\036\102\236\113\015\053"
	"\323\027\113\210\030\133\111\251\022\227\123\326\063\050\341\274"
	"\173\223\247\132\227\126\325\072\145\336\213\311\307\246\320\077"
	"\160\015\016\307\317\204\256\266\060\100\152\341\333\321\317\175"
	"\026\014\221\370\161\071\125\063\134\222\215\241\253\167\124\027"
	"\224\274\232\161\020\103\301\365\364\016\334\010\133\274\213\017"
	"\222\105\255\141\212\066\374\347\327\163\237\254\001\104\056\321"
	"\131\074\100\240\341\102\273\002\221\322\230\132\220\166\051\271"
	"\060\354\147\321\144\250\345\333\004\127\066\356\114\367\307\302"
	"\170\352\077\057\225\011\237\316\133\215\335\275\136\253\317\033"
	"\153\242\273\072\047\337\265\370\075\121\074\020\010\323\005\376"
	"\053\116\110\310\024\331\113\003\243\356\330\077\376\000\123\033"
	"\241\304\372\160\316\055\137\075\156\233\367\076\370\327\173\116"
	"\072\307\370\210\252\005\364\330\020\262\302\014\341\150\230\152"
	"\213\073\215\165\061\327\204\316\350\002\333\146\010\276\257\154"
	"\166\044\064\006\254\210\142\300\336\007\377\247\260\152\117\350"
	"\241\031\073\105\217\226\047\226\013\313\212\117\071\215\101\174"
	"\314\342\022\121\166\241\350\223\251\321\342\121\374\176\313\034"
	"\370\222\341\366\101\003\342\025\127\250\101\152\101\343\104\060"
	"\146\241\372"
#define      xecc_z	15
#define      xecc	((&data[2380]))
	"\205\323\025\045\041\023\350\330\041\026\124\062\334\224\244\263"
	"\050\260"
#define      tst2_z	19
#define      tst2	((&data[2401]))
	"\060\233\313\142\337\276\033\030\123\005\120\046\246\361\041\075"
	"\037\234\344\223\144\146\131\016"
#define      msg1_z	65
#define      msg1	((&data[2424]))
	"\335\351\020\027\333\073\057\011\054\026\112\131\052\273\255\022"
	"\074\027\340\155\373\125\350\166\236\157\266\327\330\142\012\114"
	"\053\317\306\361\012\342\227\050\207\161\242\146\001\252\020\367"
	"\273\226\126\251\276\373\112\207\360\340\204\342\010\002\355\125"
	"\005\110\027\335\104\200\172\276"
#define      tst1_z	22
#define      tst1	((&data[2496]))
	"\020\337\202\241\307\273\103\241\114\202\236\007\166\243\046\041"
	"\336\363\334\240\373\037\376\030\213\374"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
